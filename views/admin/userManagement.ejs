<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="/styles/admin.css" />
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <h3 class="text-white text-center">Chipkart Admin</h3>
      <a href="/admin"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      <a href="/admin/users" class="sidebar-active"
        ><i class="fas fa-users"></i> User Management</a
      >
      <a href="/admin/products"
        ><i class="fas fa-cogs"></i> Product Management</a
      >
      <a href="/admin/categories"
        ><i class="fas fa-tags"></i> Category Management</a
      >
      <a href="/admin/offers"><i class="fas fa-gift"></i> Offer Module</a>
      <a href="/admin/orders"><i class="fas fa-box"></i> View Orders</a>
      <a href="/admin/reports"
        ><i class="fas fa-chart-line"></i> Sales Report</a
      >
      <a href="/admin/coupons"><i class="fas fa-gift"></i> Coupon Management</a>
    </div>

    <!-- Main Content -->
    <div class="content-wrapper">
      <!-- Navbar -->
      <%- include("../partials/adminHeader") %>

      <div class="main-content">
        <div class="search-box">
          <form action="/admin/users/search" method="get" class="search-form">
            <input type="search" name="query" id="query" placeholder="Search user" required  value="<%= searchQuery || '' %>">
            <button type="submit">Search</button>
            <small id="errorMessage" class="text-danger"></small>
          </form>
          

        </div>
        <table class="table">
          <thead>
            <tr>
              <th>No</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone Number</th>
              <th>Is Verified</th>
              <th>Is Admin</th>
              <th>Is Blocked</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% if (usersArray.length === 0) { %>
              <tr>
                <td colspan="8" class="text-center">No users found</td>
              </tr>
            <% } else { %>
              <% usersArray.forEach((user, index) => { %>
                <tr>
                  <td><%= index + 1 %></td>
                  <td><%= user.name %></td>
                  <td><%= user.email %></td>
                  <td><%= user.phoneNumber %></td>
                  <td><%= user.isVerified ? 'Yes' : 'No' %></td>
                  <td><%= user.isAdmin ? 'Yes' : 'No' %></td>
                  <td><%= user.isBlocked ? 'Yes' : 'No' %></td>
                  <td>
                    <form action="/admin/users/toggle-block/<%= user.id %>" method="post" style="display:inline;">
                      <button class="btn <%= user.isBlocked ? 'btn-success' : 'btn-danger' %> btn-sm">
                        <%= user.isBlocked ? 'Unblock' : 'Block' %>
                      </button>
                    </form>
                  </td>
                </tr>
              <% }); %>
            <% } %>
            
          </tbody>
        </table>
      </div>
      
      
      
    </div>

    <script src="/javascripts/admin/management.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
  </body>
</html>
